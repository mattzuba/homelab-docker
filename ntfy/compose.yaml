version: '3'

include:
  - path: ../common/acme/compose.yaml
  - path: ../common/cloudflare/compose.yaml
  - path: ../common/portainer/compose.yaml
  - path: ../common/watchtower/compose.yaml
  - path: ../common/promtail/compose.yaml

services:
  ntfy:
    image: binwiederhier/ntfy:latest
    restart: unless-stopped
    command: serve
    hostname: ntfy.${HOSTNAME:?Set the HOSTNAME .env variable}
    ports:
      - "9091:9090"
    volumes:
      - ./ntfy.yaml:/etc/ntfy/server.yml
      - ntfy_cache:/var/cache/ntfy
      - ntfy_data:/var/lib/ntfy
      - acme_certs:/opt/ssl
    labels:
      - sh.acme.autoload.domain=ntfy
      - com.centurylinklabs.watchtower.scope=${HOSTNAME}
      - com.grafana.promtail=true

volumes:
  ntfy_cache:
  ntfy_data:
